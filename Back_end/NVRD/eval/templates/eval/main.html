<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVRD-PLogger</title>
    <link rel="stylesheet" href="https://bootswatch.com/4/flatly/bootstrap.css">
    <script id='admin_JS'></script>
    <script id='coordinator_JS'></script>
    <script id='evaluator_JS'></script>
    <script type="text/javascript" id='main_JS'>
        function loadJS(url) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    elem = returnCurrentJS()
                    elem.innerHTML = this.responseText;
                }
            };
            xhttp.open("GET", url + 'JS/', true);
            xhttp.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
            xhttp.setRequestHeader("sessionid", getCookie("sessionid"));
            xhttp.send();
        }
        function loadHTML(url) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    elem = returnCurrentHTML()
                    elem.innerHTML = this.responseText;
                    refresher()
                }
            };
            xhttp.open("GET", url + 'HTML/', true);
            xhttp.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
            xhttp.setRequestHeader("sessionid", getCookie("sessionid"));
            xhttp.send();
        }
        var Tree = { "Admin": [], "Coordinator": [], "Evaluator": [] }
        var evalview = { 1: { "Student": [], "Team": [] }, 2: { "Student": [], "Team": [] }, 3: { "Student": [], "Team": [] }, 4: { "Student": [], "Team": [] }, 5: { "Student": [], "Team": [] }, "Team": [], "Student": [], "Faculty-Panel": [] }
        var coordview = { "Department": [], "Faculty-Panel": [], "Team-Faculty-Review": [] }
        var adminview = { "Department": [], "Faculty": [], "Panel": [], "Faculty-panel": [], "Team": [], "Student": [], "Marks-View": [] }
        var User;
        var Admin_BC = []
        var Coordinator_BC = []
        var Evaluator_BC = []
        var currenttab;
        function returnCurrentHTML() {
            var lst = NaN
            if (currenttab == "Admin")
                lst = document.getElementById("admin_HTML")
            else if (currenttab == "Coordinator")
                lst = document.getElementById("coordinator_HTML")
            else if (currenttab == "Evaluator")
                lst = document.getElementById("evaluator_HTML")
            return lst;
        }
        function returnCurrentJS() {
            var lst = NaN
            if (currenttab == "Admin")
                lst = document.getElementById("admin_JS")
            else if (currenttab == "Coordinator")
                lst = document.getElementById("coordinator_JS")
            else if (currenttab == "Evaluator")
                lst = document.getElementById("evaluator_JS")
            return lst;
        }
        function returnCurrentList() {
            var lst = NaN
            if (currenttab == "Admin")
                lst = Admin_BC
            else if (currenttab == "Coordinator")
                lst = Coordinator_BC
            else if (currenttab == "Evaluator")
                lst = Evaluator_BC
            return lst;
        }
        function refresher() {
            if (currenttab == "Admin") {
                admin_refresh()
            }
            else if (currenttab == "Coordinator") {
                coordinator_refresh()
            }
            else if (currenttab == "Evaluator") {
                evaluator_refresh()
            }
        }
        function refreshLoader(xhttp) {
            xhttp.onloadstart = function (e) {
                p = document.getElementById("progress")
                p.setAttribute('style', 'width:' + 0 + '%')
                p.setAttribute('aria-valuemax', e.total)
                p.setAttribute('aria-valuenow', '0')
            }
            xhttp.onprogress = function (e) {
                p = document.getElementById("progress")
                p.setAttribute('style', 'width:' + e.loaded + '%')
                p.setAttribute('aria-valuemax', e.total)
                p.setAttribute('aria-value', e.loaded)
            }
            xhttp.onloadend = function (e) {
                setTimeout(function () {
                    p = document.getElementById("progress")
                    p.setAttribute('style', 'display:none')
                    p.setAttribute('aria-valuemax', e.total)
                    p.setAttribute('aria-value', e.loaded)
                }, 750)
            }
        }
        window.addEventListener('hashchange', function (e) {
            if (window.location.hash != "") {
                spl = window.location.hash.split("#")[1].split('/')
                spl.pop()
                currenttab = spl[0]
                var lst = returnCurrentList()
                var len = lst.length
                for (let i = 0; i < len; i++) {
                    lst.pop()
                }
                for (let i = 0; i < spl.length; i++) {
                    lst.push(spl[i])
                }
                crumbMaker()
            }
        });
        function setTree() {
            var xhttp = new XMLHttpRequest()
            xhttp.onreadystatechange = function () {
                if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
                    let data = JSON.parse(this.responseText)
                    User = data["user"]
                    if (data["user"]["is_admin"] == true) {
                        Tree.Admin = adminview
                    }
                    for (let i = 0; i < data["panels"].length; i++) {
                        if (Tree.Evaluator.includes(data["panels"][i]["panel_year_code"] + '-' + data["panels"][i]["panel_id"]) == false) {
                            var st = data["panels"][i]["panel_year_code"] + '-' + data["panels"][i]["panel_id"]
                            Tree.Evaluator[st] = evalview
                        }
                        if (data["panels"][i]["is_coordinator"] == true && Tree.Coordinator.includes(["panels"][i]["panel_year_code"] + '-' + data["panels"][i]["panel_id"]) == false) {
                            var st = data["panels"][i]["panel_year_code"] + '-' + data["panels"][i]["panel_id"]
                            Tree.Coordinator[st] = coordview
                        }
                    }
                    Admin_BC.push("Admin")
                    Coordinator_BC.push("Coordinator")
                    Evaluator_BC.push("Evaluator")
                    navbarGenerate()
                }
            }
            xhttp.open("GET", "/api/" + getCookie("username") + "/aboutme/", true);
            xhttp.setRequestHeader("Authorization", "Bearer " + getCookie("token"));
            xhttp.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
            xhttp.setRequestHeader("sessionid", getCookie("sessionid"));
            xhttp.send()
        }
        function crumbMaker() {
            lst = returnCurrentList()
            NVRDbreadcrumb = document.getElementById(id = "NVRDbreadcrumb")
            len = NVRDbreadcrumb.children.length
            for (let i = 0; i < len; i++) {
                NVRDbreadcrumb.removeChild(NVRDbreadcrumb.children[0])
            }
            for (let i = 0; i < lst.length; i++) {
                elem = document.createElement("li")
                elem.innerHTML = lst[i]
                if (i + 1 == lst.length) {
                    elem.setAttribute('aria-current', 'page')
                    elem.setAttribute('class', 'breadcrumb-item active')
                }
                else {
                    elem.setAttribute('class', 'breadcrumb-item')
                }
                elem.addEventListener('click', crumbPopper)
                NVRDbreadcrumb.appendChild(elem)
            }
            NVRDbreadcrumb = document.getElementById(id = "NVRDbreadcrumb")
            //elem = document.createElement("li")
            //elem.setAttribute('class', 'breadcrumb-item')
            //elem.addEventListener('click', crumbPopper)
            //NVRDbreadcrumb.appendChild(elem)
            listMaker()
            urlstr = ""
            for (let i = 0; i < lst.length; i++) {
                urlstr += (lst[i] + '/')
            }
            window.location.hash = urlstr;
        }
        function crumbPopper(e) {
            lst = returnCurrentList()
            ind = lst.indexOf(e.target.innerHTML)
            len = lst.length
            for (let i = ind + 1; i < len; i++)
                lst.pop()
            crumbMaker()
        }
        function crumbPusher(e) {
            lst = returnCurrentList()
            lst.push(e.target.innerHTML)
            crumbMaker()
        }
        function listMaker() {
            lst = returnCurrentList()
            obj = Tree;
            for (let i = 0; i < lst.length; i++) {
                obj = obj[lst[i]]
            }
            if (Object.keys(obj).length > 0) {
                returnCurrentHTML().innerHTML = ""
                document.getElementById('NVRDlist').setAttribute('style', 'display:inline')
                NVRDlist = document.getElementById("NVRDlist")
                len = NVRDlist.children.length
                for (let i = 0; i < len; i++) {
                    NVRDlist.removeChild(NVRDlist.children[0])
                }

                for (let i = 0; i < Object.keys(obj).length; i++) {
                    elem = document.createElement("button")
                    elem.setAttribute('class', 'list-group-item list-group-item-action');
                    elem.addEventListener('click', crumbPusher)
                    elem.innerHTML = Object.keys(obj)[i]
                    NVRDlist.appendChild(elem)
                }
            }
            else {
                document.getElementById("admin_HTML").setAttribute('style', 'display:none')
                document.getElementById("coordinator_HTML").setAttribute('style', 'display:none')
                document.getElementById("evaluator_HTML").setAttribute('style', 'display:none')
                document.getElementById('NVRDlist').setAttribute('style', 'display:none')
                returnCurrentHTML().setAttribute('style', 'display:inline')
                loadJS(urlGenerate())
                loadHTML(urlGenerate())
            }
        }
        function urlGenerate() {
            var lst = returnCurrentList()
            return "/" + getCookie("username") + ("/home/" + lst.join("/") + '/').toLowerCase()
        }
        function onClickNavbar(e) {
            NVRDnavbar = document.getElementById('NVRDnavbar').children;
            for (let i = 0; i < NVRDnavbar.length; i++) {
                if (e.target.innerHTML == NVRDnavbar[i].innerHTML) {
                    NVRDnavbar[i].setAttribute('class', 'nav-item nav-link active')
                    currenttab = NVRDnavbar[i].innerHTML
                }
                else {
                    NVRDnavbar[i].setAttribute('class', 'nav-item nav-link')
                }
            }
            crumbMaker()
        }
        function navbarGenerate() {
            NVRDnavbar = document.getElementById("NVRDnavbar")
            if (Object.keys(Tree.Admin).length > 0) {
                elem = document.createElement('a')
                elem.innerHTML = "Admin"
                elem.addEventListener('click', onClickNavbar)
                elem.setAttribute('class', 'nav-item nav-link')
                NVRDnavbar.appendChild(elem)
            }
            if (Object.keys(Tree.Coordinator).length > 0) {
                elem = document.createElement('a')
                elem.addEventListener('click', onClickNavbar)
                elem.setAttribute('class', 'nav-item nav-link')
                elem.innerHTML = "Coordinator"
                NVRDnavbar.appendChild(elem)
            }
            if (Object.keys(Tree.Evaluator).length > 0) {
                elem = document.createElement('a')
                elem.addEventListener('click', onClickNavbar)
                elem.setAttribute('class', 'nav-item nav-link')
                elem.innerHTML = "Evaluator"
                NVRDnavbar.appendChild(elem)
            }
        }
        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
    </script>
</head>

<body onload="setTree()">
    <div class="sticky-top">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <a class="navbar-brand" href="#">NVRD</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav" id='NVRDnavbar'>
                    <!-- <a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link" href="#">Features</a>
            <a class="nav-item nav-link" href="#">Pricing</a>
            <a class="nav-item nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a> -->

                </div>
            </div>
        </nav>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" id="NVRDbreadcrumb">
                <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item"><a href="#">Library</a></li>
            <li class="breadcrumb-item active">Data</li> -->
            </ol>
        </nav>
        <div class="progress fixed-bottom" id="progressParent">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning"
                style="position:relative;top:25px" role="progressbar" aria-valuenow="75" aria-valuemin="0"
                aria-valuemax="100" style="display:none" id="progress">
            </div>
        </div>
    </div>
    <div class="list-group" id="NVRDlist">
        <!-- <button type="button" class="list-group-item list-group-item-action active">
            Cras justo odio
        </button>
        <button type="button" class="list-group-item list-group-item-action">Dapibus ac facilisis in</button>
        <button type="button" class="list-group-item list-group-item-action">Morbi leo risus</button>
        <button type="button" class="list-group-item list-group-item-action">Porta ac consectetur ac</button>
        <button type="button" class="list-group-item list-group-item-action" disabled>Vestibulum at eros</button> -->
    </div>
    <div id="admin_HTML"></div>
    <div id="coordinator_HTML"></div>
    <div id="evaluator_HTML"></div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->


    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script> -->
</body>

</html>